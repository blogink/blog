<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>灵活的 AI 工作流：ComfyUI 上手使用 | 雨梦清欢</title><meta name="author" content="R҉anm⌬"><meta name="copyright" content="R҉anm⌬"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="（其实是2024年底写的，但我使用时遇到个问题，一直未能解决。再加上当时因为一些事情，遂致此文拖至现在才更新……） 或许是我现在使用的设备确实有点老了，也可能是我的配置方法不对，RWKV 生成音乐，但效果比较奇怪；MusicGPT 一键包运行后，卡在那不动了。AudioCraft 看着效果不错，但官方推荐配置给我劝退了，至少现在我还用不来。Stability AI 有个 Stable Audio，">
<meta property="og:type" content="article">
<meta property="og:title" content="灵活的 AI 工作流：ComfyUI 上手使用">
<meta property="og:url" content="https://blog.sakurink.eu.org/posts/2709533729/index.html">
<meta property="og:site_name" content="雨梦清欢">
<meta property="og:description" content="（其实是2024年底写的，但我使用时遇到个问题，一直未能解决。再加上当时因为一些事情，遂致此文拖至现在才更新……） 或许是我现在使用的设备确实有点老了，也可能是我的配置方法不对，RWKV 生成音乐，但效果比较奇怪；MusicGPT 一键包运行后，卡在那不动了。AudioCraft 看着效果不错，但官方推荐配置给我劝退了，至少现在我还用不来。Stability AI 有个 Stable Audio，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdncf-assets.sakurink.eu.org/blogassets/img/randimg/7.jpg">
<meta property="article:published_time" content="2025-08-06T12:40:45.000Z">
<meta property="article:modified_time" content="2025-08-06T12:40:48.000Z">
<meta property="article:author" content="R҉anm⌬">
<meta property="article:tag" content="程序">
<meta property="article:tag" content="AI 绘图">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdncf-assets.sakurink.eu.org/blogassets/img/randimg/7.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "灵活的 AI 工作流：ComfyUI 上手使用",
  "url": "https://blog.sakurink.eu.org/posts/2709533729/",
  "image": "//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/7.jpg",
  "datePublished": "2025-08-06T12:40:45.000Z",
  "dateModified": "2025-08-06T12:40:48.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "R҉anm⌬",
      "url": "https://blog.sakurink.eu.org"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.sakurink.eu.org/posts/2709533729/index.html"><link rel="preconnect" href="https://npm.elemecdn.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://npm.elemecdn.com/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/node-snackbar@latest/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/@fancyapps/ui@latest/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  infinitegrid: {
    js: 'https://npm.elemecdn.com/@egjs/infinitegrid@latest/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '灵活的 AI 工作流：ComfyUI 上手使用',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="robots" content="noarchive"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" /><meta name="referrer" content="no-referrer-when-downgrade" /><noscript> <strong> 本站需要启用JavaScript才能运行 </strong> </noscript><link rel="stylesheet" href="/css/sakurink.css"/><link rel="stylesheet" href="/css/consolex.css"/><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="only x" onload="this.onload=null;this.media='all'" /><link rel="stylesheet" href="https://cdncf-assets.sakurink.eu.org/libs/fonts/JiangChengYuanTi-400W/result.css" media="only x" onload="this.onload=null;this.media='all'" /><link rel="stylesheet" href="https://cdncf-assets.sakurink.eu.org/libs/fonts/SourceHanSansCN-Normal/result.css" media="only x" onload="this.onload=null;this.media='all'" /><link rel="stylesheet" href="https://cdncf-assets.sakurink.eu.org/libs/fonts/SourceHanSansCN-Medium/result.css" media="only x" onload="this.onload=null;this.media='all'" /><link rel="stylesheet" href="https://cdncf-assets.sakurink.eu.org/libs/fonts/SourceHanSerifSC-Medium/result.css" media="only x" onload="this.onload=null;this.media='all'" /><link rel="stylesheet" href="/css/lanterns.css" media="only x" onload="this.onload=null;this.media='all'"><link rel="stylesheet" href="/css/runtime.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="雨梦清欢" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="雨梦清欢" type="application/rss+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/pace1.css"/><script src="https://npm.elemecdn.com/pace-js@latest/pace.min.js"></script><div id="web_bg" style="background-image: url(//cdncf-assets.sakurink.eu.org/blogassets/img/background_img.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">92</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-link"></i><span> 友链</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/friends/"><i class="fa-fw fas fa-user-group"></i><span> 友链</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-chalkboard"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cubes"></i><span> 通用</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 【我】</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-cloud-upload"></i><span> 更新</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/7.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">雨梦清欢</span></a><a class="nav-page-title" href="/"><span class="site-name">灵活的 AI 工作流：ComfyUI 上手使用</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-link"></i><span> 友链</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/friends/"><i class="fa-fw fas fa-user-group"></i><span> 友链</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-chalkboard"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cubes"></i><span> 通用</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 【我】</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-cloud-upload"></i><span> 更新</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">灵活的 AI 工作流：ComfyUI 上手使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-06T12:40:45.000Z" title="发表于 2025-08-06 20:40:45">2025-08-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-06T12:40:48.000Z" title="更新于 2025-08-06 20:40:48">2025-08-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BB%8F%E9%AA%8C%E8%AE%B0%E5%BD%95/">经验记录</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>（其实是2024年底写的，但我使用时遇到个问题，一直未能解决。再加上当时因为一些事情，遂致此文拖至现在才更新……）</p>
<p>或许是我现在使用的设备确实有点老了，也可能是我的配置方法不对，RWKV 生成音乐，但效果比较奇怪；MusicGPT 一键包运行后，卡在那不动了。AudioCraft 看着效果不错，但官方推荐配置给我劝退了，至少现在我还用不来。Stability AI 有个 Stable Audio，但我安装后却跑不起来（可能我的配置确实太低了）。</p>
<p>好像有人把 Stable Audio Open 做成了 ComfyUI 组件。当时我对 ComfyUI 的认识停留在“一个和 WebUI 外观不同的绘图工具”上，觉得多装一个 ComfyUI 是不是重复了……</p>
<p>结果，某次我启动完几个必要的软件后，SD WebUI 出图卡死了，Forge 亦然。emmm……看来我确实应该尝试一下新东西了。</p>
<p>（感觉有很多新的插件，优先适配的是 ComfyUI 而非 WebUI。）</p>
<h2 id="对比-WebUI">对比 WebUI</h2>
<p>对于使用 AI 绘图的玩家而言，Stable Diffusion WebUI 算是比较知名的程序了，此处不再赘述。先来看看二者的区别：</p>
<p><img src="https://s2.loli.net/2024/12/29/uk3b9ZQxgWJfRT8.png" alt=""></p>
<p>可以很直观地看到，WebUI 的各配置项一目了然。借用网上一篇文章的话来形容：WebUI 相当于一体机，许多功能已经集成好；ComfyUI 相对于自由组装的电脑，所有配件按需准备、自由组装，可以通过搭配得到各式各样的“电脑”。</p>
<p>你需要什么功能，找到它并调整参数即可，上手难度比较低。但仅靠调整参数，局限性比较大，且一点微小的差异都可能导致与预期结果有不小的差别。那么 ComfyUI 这颗于 2023 下半年升起的“新星”呢？</p>
<p><img src="https://s2.loli.net/2024/12/29/MFEXYzg1l9Kxrco.png" alt=""></p>
<p>如果你使用过 DaVinci Resolve、Maya、Unity 之类的软件，或许对这种界面比较熟悉，但对于没接触过工作流的人而言，入门门槛相对较高。不过熟悉这种节点式的界面和工作流后，其可玩性会更好（例如生成图像、视频、3D，甚至语言模型、音乐等）。得益于其工作流的设计，你可以很方便地保存和复现自己或别人的工作流程（你甚至不必理解整个工作流的细节）。</p>
<p>总而言之：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>SD-Webui</th>
<th>ComfyUI</th>
</tr>
</thead>
<tbody>
<tr>
<td>界面</td>
<td>界面简洁，易于导航，适合初学者</td>
<td>界面相对复杂，提供更多自定义选项</td>
</tr>
<tr>
<td>配置</td>
<td>要求较高（官方建议最低 4GB；Forge 版是第三方的，对配置要求更低，但存在兼容性问题）</td>
<td>要求较低（3GB 显存即可运行）</td>
</tr>
<tr>
<td>性能</td>
<td>占用资源较多，出图略慢</td>
<td>性能优化较好，适合高性能需求用户</td>
</tr>
<tr>
<td>功能</td>
<td>功能全面，可以满足大多数图像生成需求</td>
<td>功能更丰富，生成内容不仅限于图像</td>
</tr>
<tr>
<td>社区与扩展</td>
<td>社区活跃，生态丰富，可扩展性好</td>
<td>经过发展，社区支持也较完善，插件丰富，但兼容性稍低</td>
</tr>
<tr>
<td>上手难度</td>
<td>配置相对简单，教程和社区支持丰富，适合入门</td>
<td>配置灵活，但这需要一定的技术，学习曲线陡峭</td>
</tr>
</tbody>
</table>
<p>（注：上手 ComfyUI 建议做好经常与红紫框、报错的心理准备。但这或许不是它的缺点）</p>
<p>这是一个。但是，<a target="_blank" href="https://www.comfy.org" rel="external nofollow noreferrer noopener">comfy.org</a> 官网上有这样一句话：</p>
<blockquote>
<p>Crafting the next frontier of visual and audio media</p>
</blockquote>
<p>又看了 GitHub 上的 README：</p>
<blockquote>
<p>The most powerful and modular diffusion model GUI and backend</p>
</blockquote>
<p>如果你见过用过的节点足够丰富，你会注意到有些节点似乎不是为 SD 生成图片而设计的（当然，它们可能也不是 3GB 显存能用的了）。</p>
<h2 id="安装与配置">安装与配置</h2>
<p>进入 <a target="_blank" href="https://github.com/comfyanonymous/ComfyUI" rel="external nofollow noreferrer noopener">comfyanonymous/ComfyUI</a> 页面，按照自己的设备选择合适的方式安装。开发者已经制作了 Windows 系统下的可移植包（NVIDIA 显卡运行或仅 CPU 运行），可以点击 <a target="_blank" href="https://github.com/comfyanonymous/ComfyUI/releases/latest/download/ComfyUI_windows_portable_nvidia.7z" rel="external nofollow noreferrer noopener">Direct link to download</a> 进行下载。</p>
<p>Windows 用户还可以使用第三方一键包，例如秋葉 aaaki 的 <a target="_blank" href="https://www.bilibili.com/video/av326388194/" rel="external nofollow noreferrer noopener">ComfyUI 整合包</a>（话说后来玩 AI 绘图的应该也都认识这位 UP 主了罢）；也可以下载官方可移植包后使用绘世启动器进行管理，把启动器文件放到<code>ComfyUI</code>目录下（官方一键包也是这个目录）然后启动，等待启动器初始化即可。</p>
<p>程序的详细安装过程见官方仓库中的介绍。我使用了一键包，Windows 下不敢手动配置，起码目前不敢 <s>（不知为何，Python 在我目前的设备上“水土不服”，总能给我整出些大动静）</s> ，但手动配置比一键包的稳定性好。</p>
<p>之后进入 ComfyUI 根目录中的 Model 目录，这是存放 ComfyUI 模型的地方。只配置图像生成模型，只需关注 checkpoints（检查点模型，即“大模型”）、Loras（LORA 模型）、controlnet 、vae 这些文件夹。只需要进入对应的文件夹，把匹配的模型放入，程序便能自动加载。没有模型？请自行前往 <a target="_blank" href="https://civitai.com/" rel="external nofollow noreferrer noopener">Civitai</a>（没有网络条件的可以访问 <a target="_blank" href="https://civitai.work/support" rel="external nofollow noreferrer noopener">Civitai 中国镜像</a>，但不要直接访问镜像站本体域名，需要在后面带上路径（无论是否存在），否则无法加载）或 <a target="_blank" href="https://huggingface.co/" rel="external nofollow noreferrer noopener">HuggingFace</a>，找寻合适的模型下载。</p>
<p>但是，如果你已经使用一段时间 WebUI 了，或者希望将其与 WebUI 共存，那么模型怎么办？ComfyUI 是支持共享 WebUI 模型的，在根目录下找到一个名为<code>extra_model_paths.yaml.example</code>的文件，将其后缀<code>.example</code>去除（修改后扩展名应为<code>yaml</code>）并编辑（建议复制一份后再改后缀）。这里演示检查点模型和 controlnet 模型路径的配置方法，具体路径请根据自己的情况变通。</p>
<p>（请注意，yaml 文件对缩进敏感；由于复制时可能存在格式问题，此处只需关注删增行的缩进。这里使用的 diff 代码块中，部分行最前面的加减号是用于标记添加或删除的，在实际修改或添加内容时，需要将其去除，去除标记后的代码缩进是正确的。删增行后的注释仅作说明作用，可以不用复制。另外，由于我在 Windows 上使用，此处绝对路径部分使用了反斜杠，Linux 用户可能需使用普通的斜杠）</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 省略。..</span><br><span class="line"></span><br><span class="line"># config for a1111 ui</span><br><span class="line"># all you have to do is change the base_path to where yours is installed</span><br><span class="line">a111:</span><br><span class="line"><span class="deletion">-    base_path: path/to/stable-diffusion-webui/</span></span><br><span class="line"><span class="addition">+    base_path: E:\SD-WebUI # 假设你的 SD-WebUI 在 E 盘的根目录下，下同</span></span><br><span class="line"></span><br><span class="line">    checkpoints: models/Stable-diffusion</span><br><span class="line">    configs: models/Stable-diffusion</span><br><span class="line">    vae: models/VAE</span><br><span class="line">    loras: |</span><br><span class="line">         models/Lora</span><br><span class="line">         models/LyCORIS</span><br><span class="line">    upscale_models: |</span><br><span class="line">                  models/ESRGAN</span><br><span class="line">                  models/RealESRGAN</span><br><span class="line">                  models/SwinIR</span><br><span class="line">    embeddings: embeddings</span><br><span class="line">    hypernetworks: models/hypernetworks</span><br><span class="line"><span class="deletion">-    controlnet: models/ControlNet</span></span><br><span class="line"><span class="addition">+    controlnet: E:\SD-WebUI\models\ControlNet # 默认情况下，在 SD-WebUI 中的 controlnet 模型路径应如此；还有一种可能是在 E:\SD-WebUI\extensions\sd-webui-controlnet\models 中。</span></span><br><span class="line"></span><br><span class="line"># config for comfyui</span><br><span class="line"># your base path should be either an existing comfy install or a central folder where you store all of your models, loras, etc.</span><br><span class="line"></span><br><span class="line"># 省略。..</span><br></pre></td></tr></table></figure>
<p>一切准备妥当后，启动程序（使用绘世启动器管理的，点击主页面<code>一键启动</code>），等待程序完成初始化环境配置后，在浏览器中输入<code>http://127.0.0.1:8188/</code>，若 ComfyUI 正常加载则启动成功。</p>
<p>秋叶的整合包已经预配置了一些常用节点和界面汉化，可以更快速地上手使用。之后的演示也是使用该整合包进行。另外，在 2024 年 7 月初，ComfyUI 官方更新了新的 UI 界面（可以设置回旧 UI），因此下文的示例将基于新版 UI 进行。</p>
<p>有些实用的插件可以一起安装了（<code>250826更新</code>）：</p>
<table>
<thead>
<tr>
<th>名称和链接</th>
<th>功能简介</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" href="https://github.com/ltdrdata/ComfyUI-Manager" rel="external nofollow noreferrer noopener">ComfyUI-Manager</a></td>
<td>增强 ComfyUI 的可用性，便于管理自定义节点、更新程序、查阅手册等</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/AIGODLIKE/AIGODLIKE-ComfyUI-Translation" rel="external nofollow noreferrer noopener">AIGODLIKE-ComfyUI-Translation</a></td>
<td>多语言翻译插件，对 ComfyUI 做了较完善的汉化</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/thisjam/comfyui-sixgod_prompt" rel="external nofollow noreferrer noopener">comfyui-sixgod_prompt</a></td>
<td>类似于 SD-WebUI 中的 prompt-all-in-one，便于输入提示词。还有一个功能相似的插件 <a target="_blank" href="https://github.com/weilin9999/WeiLin-ComfyUI-prompt-all-in-one" rel="external nofollow noreferrer noopener">WeiLin-ComfyUI-prompt-all-in-one</a>（注：现已更新为<a target="_blank" href="https://github.com/weilin9999/WeiLin-Comfyui-Tools" rel="external nofollow noreferrer noopener">WeiLin-Comfyui-Tools</a>）</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/Fannovel16/comfyui_controlnet_aux" rel="external nofollow noreferrer noopener">comfyui_controlnet_aux</a></td>
<td>常用的 ControlNet 预处理器</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/Kosinkadink/ComfyUI-Advanced-ControlNet" rel="external nofollow noreferrer noopener">ComfyUI-Advanced-ControlNet</a></td>
<td>ControlNet 的高级特性</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/AlekPet/ComfyUI_Custom_Nodes_AlekPet" rel="external nofollow noreferrer noopener">ComfyUI_Custom_Nodes_AlekPet</a></td>
<td>扩展 ComfyUI 功能的自定义节点，例如 ControlNet 姿势、文本翻译并返回字符串、校正图像颜色、直接运行代码等</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/yolain/ComfyUI-Easy-Use" rel="external nofollow noreferrer noopener">ComfyUI-Easy-Use</a></td>
<td>一个效率定制节点集成包，在 TinyTerraNodes 的基础上进行扩展。它已集成并优化了许多流行的 awesome 定制节点，以实现 ComfyUI 更快、更便捷的使用。在确保自由度的同时，它恢复了属于 Stable Diffusion 的终极平滑图像生产体验。</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/crystian/ComfyUI-Crystools.git" rel="external nofollow noreferrer noopener">ComfyUI-Crystools</a></td>
<td>使用这套工具，你可以查看资源监视器、进度条和经过的时间、元数据，并比较两张图像、比较两个 JSON 文件、将任何值显示到控制台/显示器、管道，以及更多！这提供了更好的节点来加载/保存图像、预览等，并且无需加载新的工作流即可查看“隐藏”数据。</td>
</tr>
<tr>
<td>……</td>
<td>……</td>
</tr>
</tbody>
</table>
<p>限于篇幅，许多插件无法在此一一列出。建议先把表格中前两个插件安装好（后文的部分操作可能还会用到这些插件），其他的插件按需配置。建议准备好网络加速工具，由于网络加速工具种类繁多，故不在此详细说明。目的是保证 GitHub、HuggingFace 的访问，镜像站也行。后面如果出现下载类的问题，可能是网络不佳所致，需自行解决“魔法上网”的问题。</p>
<p>（所谓“插件”，其实应该称“扩展”，在 ComfyUI 中为“节点”；但此处为防止给新手造成理解问题，本文有时会称其为“插件”）</p>
<h2 id="工作流">工作流</h2>
<p>（ComfyUI 加上不同的节点，能做的事情不只有绘图，但这里我们以最基本的绘图为例说明。）</p>
<p>ComfyUI 的主界面是一张画布，可以通过右键创建、编辑、删除节点。官方已经预配置的工作流，可以在顶部导航栏中的<code>工作流</code>-&gt;<code>预览模板</code>中选择并加载。也可以通过<code>工作流</code>-&gt;<code>打开</code>加载他人分享的工作流。网络上已经有开发者和爱好者分享了工作流，在 <a target="_blank" href="https://comfyui-wiki.com/zh/workflows" rel="external nofollow noreferrer noopener">ComfyUI 工作流示例</a>、<a target="_blank" href="https://comfyworkflows.com/workflows" rel="external nofollow noreferrer noopener">Comfy Workflows</a>、Civitai 网站（还是那个模型站，但它没有直接入口，而是需要在页面中过滤器里选择 workflow）等处都可以找到工作流。</p>
<p>以官方预设的文生图工作流为例。每一个矩形块就是一个节点（Nodes），连接每个节点的线就是边（Edges）。每个节点有不同的输入、输出、参数属性，不同节点的输入和输出端如果匹配，可以通过连线连接；多个节点按照一定的规则连接，形成一个完整的工作流。</p>
<p>现在我们使用一些简单的提示词，使用 Anything V5 模型创作一张图片：</p>
<p><img src="https://s2.loli.net/2024/12/29/DB6w27PyA4aeLcO.png" alt=""></p>
<ul>
<li>在最左侧的<code>Checkpoint 加载器</code>中可以选择模型，也就是之前配置的 checkpoint 模型</li>
<li>随后是两个<code>CLIP 文本编码器</code>，分别用于输入正向提示词和负面提示词（当工作流复杂时，建议在右键节点选择<code>属性</code>对其重命名，以便区分，增强工作流可读性）</li>
<li>下方有一个<code>空 Latent</code>节点，用于采样降噪，可以在其中设置图像宽高和生成单批次数量</li>
<li>Checkpoint 加载器、CLIP 文本编码器和空 Latent 被连接至<code>K 采样器</code>，在这里可以调整种子、步数、采样器等参数</li>
<li>K 采样器处理完后将数据传入<code>VAE 解码</code>节点，之前的 Checkpoint 加载器中也有一个 VAE 输出连至此处（一个大模型自身就带有 VAE，因此直接这样连接是合理的。当模型自带的 VAE 损坏或其他需要手动设置 VAE 时，需要右键-&gt;<code>新建节点</code>-&gt;<code>采样器</code>-&gt;<code>VAE 加载器</code>创建单独的 VAE 加载器节点，之后将这个节点连接到 VAE 解码节点的<code>VAE</code>输入点，此时 Checkpoint 加载器的 VAE 输出点留空）</li>
<li>最后是<code>保存图像</code>，整个流程运行完后，生成的图像在这里显示和储存</li>
</ul>
<p>配置好参数后，点击<code>执行</code>按钮，等待图像生成。默认情况下，在运行时，当前被触发的节点会被用绿框标注，随着流程的进行而变换标注节点；顶部的进度条展示的是整个工作流的生成进度和当前被触发的节点。如果你对 AI 绘图的原理比较熟悉，会注意到整个工作流与实际生成流程是一致的。如果你知晓其原理流程，那么配置工作流会方便很多。</p>
<p>当你对工作流作出修改后，想要储存或导出，同样在顶部菜单的<code>工作流</code>按钮中设置。这会将当前配置的流程和节点参数储存，下次加载时可以快速恢复上次的状态。</p>
<h2 id="保存图片命名规则">保存图片命名规则</h2>
<p>【待编写】</p>
<h2 id="复现-WebUI-效果">复现 WebUI 效果</h2>
<h3 id="二者对提示词的处理差异">二者对提示词的处理差异</h3>
<p>如果两个程序你都使用，可能会注意到，许多在 WebUI 中工作正常的提示词，到了 ComfyUI 中结果大相径庭。</p>
<p>其实，二者的提示词处理方式是存在差异的。让我们看看 <a target="_blank" href="https://comfyanonymous.github.io/ComfyUI_examples/faq/" rel="external nofollow noreferrer noopener">Frequently Asked Questions</a> 中作者是怎么说的：</p>
<blockquote>
<p><strong>Why do I get different images from the a1111 UI even when I use the same seed?</strong></p>
<p>In ComfyUI the noise is generated on the CPU. Generating noise on the CPU gives ComfyUI the advantage that seeds will be much more reproducible across different hardware configurations but also means they will generate completely different noise than UIs like a1111 that generate the noise on the GPU. Generating noise on the GPU vs CPU does not affect performance in any way.</p>
</blockquote>
<p>ComfyUI 上的噪声在 CPU 上生成，而在 a1111 的 WebUI 中，它是在 GPU 上生成的。这使得 ComfyUI 种子（seed）可以在不同的硬件配置中重现，但使它们与 a1111 的 WebUI 使用的种子不同。</p>
<p>随机种子会影响添加噪声和去除噪声过程，而这两个程序对于种子的处理不同，自然而然其生成图像的效果也有所不同。</p>
<p>还有提示词的处理差异：</p>
<blockquote>
<p>In ComfyUI the prompt strengths are also more sensitive because they are not normalized. A very short example is that when doing</p>
<p>(masterpiece:1.2) (best:1.3) (quality:1.4) girl</p>
<p>The a1111 ui is actually doing something like (but across all the tokens):</p>
<p>(masterpiece:0.98) (best:1.06) (quality:1.14) (girl:0.81)</p>
<p>In ComfyUI the strengths are not averaged out like this so it will use the strengths exactly as you prompt them.</p>
<p>There are also many other differences but these two are the ones that have most impact.</p>
</blockquote>
<p>WebUI 会将提示词的权重平均化，使其差异缩小。但在 ComfyUI 中没有这一过程，它将完全按照提示词的权重进行处理。如果你阅读过一些 SD 社区的文档，会了解到许多人不建议给出十分离谱的权重值；也许 WebUI 会帮你挽回一些效果，但 ComfyUI 不会。</p>
<p>既然知道问题所在了，那么解决方法也就有了（并不是说这么做就一定能复现在 WebUI 上的效果）。对于普通爱好者而言，不必太详细了解它们机制的细节差异，只需让 ComfyUI 以 WebUI 的方式处理提示词就行。</p>
<h3 id="如何复刻">如何复刻</h3>
<p>在这里我们需要用到这些插件：</p>
<table>
<thead>
<tr>
<th>名称和链接</th>
<th>功能简介</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" href="https://github.com/BlenderNeko/ComfyUI_ADV_CLIP_emb" rel="external nofollow noreferrer noopener">Advanced CLIP Text Encode</a></td>
<td>对提示权重的解释方式进行更多控制</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/ltdrdata/ComfyUI-Inspire-Pack" rel="external nofollow noreferrer noopener">ComfyUI-Inspire-Pack</a></td>
<td>提供了各种扩展节点（作者注：与 ComfyUI Impact Pack 中的节点相比，这里的节点具有不同的特征。Impact Pack 现在已经变得太大了……）</td>
</tr>
<tr>
<td><a target="_blank" href="https://github.com/BlenderNeko/ComfyUI_Noise" rel="external nofollow noreferrer noopener">ComfyUI Noise</a></td>
<td>允许对噪声进行更多和更灵活的控制</td>
</tr>
</tbody>
</table>
<p>但在接下来的演示中，我们只使用前两个插件提供的节点，也能较好地复现 WebUI 的效果。若精益求精，可以将第三个插件的节点也用上。可以使用 Git 或 ComfyUI-Manager（需安装插件）安装插件。</p>
<p>完成后启动并打开 ComfyUI 界面，在你准备复现 WebUI 效果的工作流的画布中，右键画布空白处-&gt;<code>新建节点</code>-&gt;<code>条件处理</code>-&gt;<code>高级</code>-&gt;<code>CLIP 文本编码器（BNK）</code>创建新的文本编码器节点（选项名称的翻译可能存在微小差别），并将节点中的<code>Token 规格化</code>保持 none 不修改，将<code>权重插值方式</code>更改为<code>A1111</code>。一般输入文本有正面和负面，以同样的方式再创建一个相同的节点（也可以在设置好后右键该节点后<code>克隆</code>）。需要注意，这里有 SD 和 SDXL 模型的区别，按照自己的情况选择。</p>
<p>之后再次在画布空白处右键-&gt;<code>新建节点</code>-&gt;<code>Inspire 节点</code>-&gt;<code>A111 适配</code>-&gt;<code>K 采样器（Inspire）</code>创建新的 K 采样器节点，并将<code>噪波模式</code>设置为<code>GPU（=A1111）</code>。</p>
<p><img src="https://s2.loli.net/2024/12/29/u5AhcqTzi2pFfXS.png" alt=""></p>
<p>新的节点设置好后，只需把原来的 CLIP 文本编码器节点和 K 采样器换节点成新的节点（重新连线），并将原来设置的其他参数照搬到新的节点中，即可完成设置。</p>
<p><img src="https://s2.loli.net/2024/12/29/Qr5mWb6a4dUJE8f.png" alt=""></p>
<h2 id="常见问题与技巧">常见问题与技巧</h2>
<h3 id="节点变红与手动安装">节点变红与手动安装</h3>
<p>如果你的工作流中出现了大量红色节点和红色提示，则表明当前环境缺少相应的节点，需要将其安装后才能正常使用。可以在顶部菜单栏找到<code>管理器</code>打开 ComfyUI 管理器面板，点击<code>安装缺失节点</code>，等待自动检测并选择安装。其他插件、更新组件、模型管理等的入口也在这里。</p>
<p><img src="https://s2.loli.net/2024/12/29/OgTLvRVAjyk537t.png" alt=""></p>
<p>这里需要确保能够正常连接 GitHub（不仅仅只是 <a target="_blank" href="http://github.com" rel="external nofollow noreferrer noopener">github.com</a> 网站）。如果网络条件不佳，可能会下载失败，此时只能手动下载。找到你所缺的节点后，记下 Git 地址，之后进入 ComfyUI 目录下的<code>custom_nodes</code>目录，在此目录下右键打开 Git Bash，执行 clone 命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> 【Git 地址】</span><br></pre></td></tr></table></figure>
<p>安装好后可能需要重载 UI 甚至重启程序才能正常加载，更新亦然。</p>
<p>不知道地址？可以在刚才的 ComfyUI 管理器界面点击<code>安装缺失节点</code>，等待加载完成后点击其 Title 列相应的标题，跳转至 GitHub 网站，找到文件列表上方的绿色<code>Code</code>按钮并点击，将<code>HTTPS</code>下方的地址记下（链接末尾一般带有<code>.git</code>），再回来执行命令（替换掉<code>【Git 地址】</code>）。</p>
<p>在<code>节点管理</code>中找到插件但无法顺利下载的也可以使用这种方法，<strong>但并不是所有的插件都可以直接用这种方式安装</strong>（这和 WebUI 不一样），因此能用 ComfyUI-Manager 或绘世启动器安装的就不要手动安装，实在需要手动安装的请仔细阅读插件说明文档。</p>
<p>整合包有 Git 但本机没安装？把命令前的<code>git</code>替换为你整合包中 Git.exe 路径即可，例如（假设你的 ComfyUI 放在 E 盘，下同）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\ComfyUI\git\cmd\git.exe <span class="built_in">clone</span> 【Git 地址】</span><br></pre></td></tr></table></figure>
<p>安装好后再回到<code>节点管理</code>中，检查安装的插件，若<code>安装</code>一列显示的是 disable、uninstall 之类的而不是<code>install</code>，则表明已经安装完成。</p>
<h3 id="Python-依赖">Python 依赖</h3>
<p>有些节点仅 clone 到本地后还需要安装依赖，一般程序在加载时会自动处理，也可以按照开发者的说明文档（<a target="_blank" href="http://README.md" rel="external nofollow noreferrer noopener">README.md</a>）手动安装依赖。例如，对于一些需要额外安装依赖的节点，可以在该节点目录中打开终端，执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<p>如果你的 Python 也是便携版的，那么需要手动指定 Python 和 pip 的路径，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\ComfyUI\python\python.exe -m pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<p><code>-m</code>可以让 Python 自动找到 pip 的路径（如果想手动指定也可以，连着<code>-m pip</code>一起换了）。</p>
<p>如果在运行时，程序终端出现类似于<code>No module named xxx</code>这种错误，也需要手动安装这些包。</p>
<h3 id="HuggingFace-设置镜像">HuggingFace 设置镜像</h3>
<p>请优先尝试调整代理软件。如果仍然未解决问题，可以更换为国内镜像站 <a target="_blank" href="https://hf-mirror.com/" rel="external nofollow noreferrer noopener">HF-Mirror</a>。</p>
<p>如果你使用的是一键包，则进入你的 ComfyUI 目录中，找到 Python 目录，进入后找到<code>python\Lib\site-packages\huggingface_hub</code>目录，打开<code>__init__.py</code>文件，拖到最底下添加一行后保存并退出文件编辑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.environ[<span class="string">&#x27;HF_ENDPOINT&#x27;</span>] = <span class="string">&#x27;https://hf-mirror.com&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如果你使用的是官方一键包，还可以使用文本编辑器打开你使用的那个脚本，在开头添加一行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> HF_ENDPOINT=https://hf-mirror.com  </span><br></pre></td></tr></table></figure>
<p>目的是让 ComfyUI 可以从环境变量读到这个设置的参数。</p>
<h3 id="VAE-紫框">VAE 紫框</h3>
<p>如果你的工作流执行到 VAE 处后，VAE 节点出现紫框并弹出报错（如果你用的是 webui，差不多也是在出图的最后一步卡住）。如果你通过任务管理器等工具查看，发现在执行到 VAE 时 GPU 占用剧增后程序报错，可以考虑下是不是爆显存导致的问题。</p>
<p>让我们看看在 SD 的出图过程中，VAE 做了什么：</p>
<ul>
<li>图像编码，将输入图像压缩成一个低维的潜在空间，提取出图像的主要特征，并以更小的表示形式存储</li>
<li>生成新图像，通过对编码的特征进行采样来生成新的图像，生成多样化的图像，并保持了其在某种程度上与训练数据的相似性</li>
<li>重构图像，通过解码器将潜在表示转换回原始图像，在这里用于生成新图像</li>
</ul>
<p>DeepSeek 是这样解释的：</p>
<p>VAE 解码器的核心任务是将低维潜在空间（latent space）的张量上（如 4×64×64）采样为高分辨率图像（如 512×512）。这一过程涉及多级上采样和卷积操作。</p>
<p>例如，单个 512 通道的 256×256 特征图（float32）占用空间：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>512</mn><mo>×</mo><mn>256</mn><mo>×</mo><mn>256</mn><mo>×</mo><mn>4</mn><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>≈</mo><mn>134</mn><mi>M</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">512×256×256×4 bytes≈134 MB
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">512</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">4</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">134</span><span class="mord mathnormal" style="margin-right:0.05017em;">MB</span></span></span></span></span></p>
<p>若批量大小为 8，则单层占用显存：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>134</mn><mi>M</mi><mi>B</mi><mo>×</mo><mn>8</mn><mo>≈</mo><mn>1</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">134MB×8≈1 GB
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">134</span><span class="mord mathnormal" style="margin-right:0.05017em;">MB</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span></span></span></span></span></p>
<p>这个过程中需要执行大量的矩阵运算和非线性激活函数，当你设定的分辨率越高，这些数据量便越大，直到超出显存限制。如果你一次性生成多张图片，那么对显存的压力也会按批量大小成倍增长。</p>
<p>若你有更好的硬件，自然是更换；若无，可以尝试启用半精度（出图质量有所下降，显存压力变小），或者干脆把 VAE 的部分放到 CPU 执行（使用绘世启动器的用户，可以前往<code>高级选项</code>-&gt;<code>使用 CPU 运行 VAE</code>将其启用）。（这样设置后，我用低配显卡也能安心跑图了，甚至生成音乐也不卡死了）</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.sakurink.eu.org">R҉anm⌬</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.sakurink.eu.org/posts/2709533729/">https://blog.sakurink.eu.org/posts/2709533729/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.sakurink.eu.org" target="_blank">雨梦清欢</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%A8%8B%E5%BA%8F/">程序</a><a class="post-meta__tags" href="/tags/AI-%E7%BB%98%E5%9B%BE/">AI 绘图</a></div><div class="post-share"><div class="social-share" data-image="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://npm.elemecdn.com/butterfly-extsrc@latest/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://npm.elemecdn.com/butterfly-extsrc@latest/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/1726040825/" title="算术课后"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">算术课后</div></div><div class="info-2"><div class="info-item-1">一支粉笔断了，躺在讲台上， 没人在意它怎么断的。 它曾在黑板上划过痕迹。 现在，黑板干干净净， 如同崭新出厂一般。 圆规还在画圈， 画好的圈，像一间间没有门窗的小屋子。 橡皮擦很忙。 这边擦掉一个算式，印子还没干透； 那边刚改的数字，又被红笔圈了出来。 纸面看着平整。 只是，涂改、擦拭久了，有些地方薄得透光。 一道折痕，不知什么时候压下的。 浅浅的，里面仿佛写着“不算”。 啪嗒—— 一滴墨水落下。 纸上鼓起一道新痕，又深又硬。 隐约的，像写着“算”。 一方镇纸压了下去，冰凉透明， 正好盖住那个“算”字。 鼓起的地方慢慢塌了，压平了。 可周围的纸，也陷了下去， 揪成一团难看的褶子。 镇纸下...</div></div></div></a><a class="pagination-related" href="/posts/1790572592/" title="可高度自定义的开源输入法：Rime 配置与使用"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">可高度自定义的开源输入法：Rime 配置与使用</div></div><div class="info-2"><div class="info-item-1">主流的输入法能根据我的输入习惯自动优化，用起来方便不少。但我不知道它们是否真的“老实”和“准确”——毕竟那些公司也不是做慈善的。 虽说在互联网时代讲“隐私”有点奢侈了，但总比什么不做来得强；而且它们给的配置有限，我不能保证它涵盖了我所有的需求。 所以接下来，让我们有请： RIME | 中州韵输入法引擎 这是什么 Rime 是一个开源的输入法引擎，它允许你高度自定义输入法的行为，简介流畅。你可以用它来创建自己的输入法方案，也可以用它来修改现有的方案，或者使用第三方开发者的方案。 但是，它只是一个输入法引擎，并非“装完就能用”的类型。“自定义程度高”，是它的优点，也是缺点。它的配置项很丰富，...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/1670947396/" title="Clash 删库停更事件"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-04</div><div class="info-item-2">Clash 删库停更事件</div></div><div class="info-2"><div class="info-item-1">此事件比较魔幻，网络上众说纷纭，具体如何不易得知，在此仅记录些我获知的内容</div></div></div></a><a class="pagination-related" href="/posts/460603327/" title="Excalidraw 开源白板工具部署"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/5.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-04</div><div class="info-item-2">Excalidraw 开源白板工具部署</div></div><div class="info-2"><div class="info-item-1">有时我需要为文档制作配图，但制作一张演示图就使用专业软件，于我而言有些大材小用。 还有些时候，我有了一个思路，但身边只有移动设备；对于某些思路而言，纯文字不如图像直观。 假如我要与他人协作，如果不用那些比较专业的工具，大多展示起来显得不便。 …… 有没有一个便捷方案可以解决这些问题？ Excalidraw 是什么 Excalidraw 是一款开源的在线白板工具，能够帮助用户快速制作简单的手绘风格的思维导图——当然，它的用途不止于此，流程图、示意图和开发架构图等常用图像，都可以用它制作。得益于它拥有实时协作、开放源码、易集成等特点，它可以为开发者和用户提供一个简单、直观且功能强大的绘图体验...</div></div></div></a><a class="pagination-related" href="/posts/117984481/" title="Linux 安装 V2-Ray"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="info-item-2">Linux 安装 V2-Ray</div></div><div class="info-2"><div class="info-item-1">本文仅供技术研究学习使用，严禁将此类工具和服务用于涉政、暴恐等违法、灰色目的，否则后果自负。 安装 Linux 系统下常用的 V2-Ray 版本是 V2RayA，访问其在 GitHub 上的仓库：https://github.com/v2rayA/v2rayA。 如果你使用了带有图形化界面的 V2-Ray，还可以使用 V2RayN。 安装 V2-Ray 内核 安装 V2-Ray 内核，可使用其提供的镜像脚本 curl -ls https://mirrors.v2raya.org/go.sh | sudo bash 安装后可以关掉服务，V2RayA 不依赖该服务 sudo systemct...</div></div></div></a><a class="pagination-related" href="/posts/2807863529/" title="NvidiaApp 如何回退到 GFE"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/3.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-11</div><div class="info-item-2">NvidiaApp 如何回退到 GFE</div></div><div class="info-2"><div class="info-item-1">我感觉 NVIDIA APP 在我的电脑上“水土不服”。虽然界面是更高级了（但感觉也差不多），但我只想用它来更新驱动。因此我打算换回 GFE。 安装回 GeForce Experience 首先先卸载 NVIDIA APP，用任何方式都可以。之后去下载 GFE 的安装包。 NVIDIA 官网 GEF 下载地址已不见踪影，但还有一篇文章中保留了它：GeForce Experience 常见问题解答。在此文章中找到下载按钮，即可获得 GFE 的安装文件。 下载完后进行安装。如果安装后发现其提示“GeForce Experience 需要进行更新”，记得千万不要重启，否则 NVIDIA APP...</div></div></div></a><a class="pagination-related" href="/posts/3085606162/" title="Tor 浏览器的安装与注意事项"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/10.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-12</div><div class="info-item-2">Tor 浏览器的安装与注意事项</div></div><div class="info-2"><div class="info-item-1">本文仅供技术学习使用，请勿利用本文内容进行任何违法、犯罪、暴力等行为，否则后果自负 另外，如果将其用于“科学用网”目的，请务必保持谨慎的态度和自己的观点，且不要到处伸张。由于外面的网络没有国内的审查，在你获得更丰富的知识的同时，也存在着撞见“不和谐”内容的风险——而且比你在国内网络遇到的场面还要离谱。 Tor 是什么 Tor（洋葱路由）网络是一个用来保护你的互联网以及隐私的匿名网络。正如其含义“洋葱”一样，它的协议和网桥将用户真实网络信息层层包裹并发送出去。Tor 是一个基于 FireFox 的“魔改版”，得益于其操作的简便性与效率，让它成为了当下最流行的暗网访问工具，让 I2P 之类的...</div></div></div></a><a class="pagination-related" href="/posts/2223589302/" title="Vercel 无服务器部署 php 程序"><img class="cover" src="//cdncf-assets.sakurink.eu.org/blogassets/img/randimg/7.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-26</div><div class="info-item-2">Vercel 无服务器部署 php 程序</div></div><div class="info-2"><div class="info-item-1">写在前面 vercel 规定了程序没有写入权限，唯一拥有写入权限的只有/tmp这个临时目录。考虑用这种方法的，大多是“实验”或 api 等小 php 项目的（特地弄个服务器不大划算？）。 你可能见过有人用这样的操作部署了 Typecho 等程序，那是另编写了类似于config.inc.php之类的配置文件实现的——不过按照这个思路实现安装 WordPress 等亦非不可。 这种实际上是把安装后会生成的配置文件提前创建好了，如果访问网站安装程序，填写的信息也需与此处的保持一致；将来使用时，凡是需要将数据在本地进行储存或修改的操作都无法正常进行。 由于众所周知的原因，请自备：  域名（前面讲...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">R҉anm⌬</div><div class="author-info-description">学习记录与分享，本网站随缘更新。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">92</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://sakurink.eu.org/" target="_blank" title=""><i class="fas fa-feather-alt"></i></a><a class="social-icon" href="https://blog.sakurink.eu.org/atom.xml" target="_blank" title=""><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">站点速度较慢，请等待全部加载完成后再进行操作，体验更佳。如果发现页面加载故障，请善用刷新。本站所有内容仅供参考，请谨慎使用，不得将其用于违规行为，否则后果自负。【当前域名请使用"https://"访问，否则大概率要被重置连接】</div></div><div class="card-widget card-ctools" id="card-ctools"><div class="item-headline"><i class="fas fa-tools"></i><span>控制器</span></div><div class="item-content"><span class="button-bfblue" onclick="javascript:location.reload()">刷新页面</span><br> <span class="button-bfblue" onclick="javascript:location.replace(location.href);">强制刷新</span><br> <!--<span class="button-bfblue" onclick="toggleWinbox()">切换背景</span><br>--> <span class="button-bfblue" onclick="openPanel()">控制面板</span></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94-WebUI"><span class="toc-number">1.</span> <span class="toc-text">对比 WebUI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">安装与配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="toc-number">3.</span> <span class="toc-text">工作流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">4.</span> <span class="toc-text">保存图片命名规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-WebUI-%E6%95%88%E6%9E%9C"><span class="toc-number">5.</span> <span class="toc-text">复现 WebUI 效果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%80%85%E5%AF%B9%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9A%84%E5%A4%84%E7%90%86%E5%B7%AE%E5%BC%82"><span class="toc-number">5.1.</span> <span class="toc-text">二者对提示词的处理差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%A4%8D%E5%88%BB"><span class="toc-number">5.2.</span> <span class="toc-text">如何复刻</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E6%8A%80%E5%B7%A7"><span class="toc-number">6.</span> <span class="toc-text">常见问题与技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E5%8F%98%E7%BA%A2%E4%B8%8E%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.</span> <span class="toc-text">节点变红与手动安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E4%BE%9D%E8%B5%96"><span class="toc-number">6.2.</span> <span class="toc-text">Python 依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HuggingFace-%E8%AE%BE%E7%BD%AE%E9%95%9C%E5%83%8F"><span class="toc-number">6.3.</span> <span class="toc-text">HuggingFace 设置镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VAE-%E7%B4%AB%E6%A1%86"><span class="toc-number">6.4.</span> <span class="toc-text">VAE 紫框</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent;"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">导航</div><div class="footer-flex-content"><a href="/about/" target="_blank" title="关于我">关于我</a><a href="/essay/" target="_blank" title="即刻短文">即刻短文</a><a href="/message/" target="_blank" title="留言板">留言板</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">服务</div><div class="footer-flex-content"><a href="/sub/" target="_blank" title="RSS 订阅">RSS 订阅</a><a href="/sitemap.xml" target="_blank" title="站点地图">站点地图</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">协议</div><div class="footer-flex-content"><a href="/license/" target="_blank" title="隐私与免责">隐私与免责</a><a href="/cookies/" target="_blank" title="Cookies">Cookies</a><a href="/cc/" target="_blank" title="版权协议">版权协议</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">工具</div><div class="footer-flex-content"><a href="https://excalidraw.lolic.dpdns.org/" target="_blank" title="白板">白板</a><a href="https://nav.lolic.dpdns.org/" target="_blank" title="工具导航">工具导航</a><a href="https://tool.lolic.dpdns.org/" target="_blank" title="实验室">实验室</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">信息</div><div class="footer-flex-content"><div> <div id="ghbdages"> <a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo" title=""> <img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""> </a> <a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题为Butterfly" title=""> <img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""> </a> <a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="本站使用JsDelivr为静态资源提供CDN加速" title=""> <img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""> </a> <a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Gtihub托管" title=""> <img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""> </a> <a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站除特殊说明外采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""> <img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""> </a> </div> </div></div></div></div></div><div class="footer-other"><div class="footer-copyright"></div><div class="footer_custom_text"> <div id="workboard" style="padding-bottom:40px"></div> </div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="settingContainer"><div class="sphide" id="settingMask"></div><div class="sphide" id="settingPanel"><div id="settingTopBar"><div class="settingTopBarLeft"><button class="hide" id="settingBackToMain2"><i class="fas fa-chevron-left"></i>返回</button><h3 class="sp-title">控制面板</h3></div><div class="settingTopBarRight"><button class="settingPanelClose" id="settingPanelClose" onclick="closePanel()">✖</button></div></div><div id="settingMain"><!-- Tabs 中的 id 与 Items 中 id 的 "-Content" 之前的部分保持一致方可完成绑定--><div class="fade fade-in" id="settingTabs"><button id="settings-general"><i class="fas fa-layer-group"></i>通用</button><button id="settings-fonts"><i class="fas fa-font"></i>字体</button><button id="settings-background"><i class="far fa-image"></i>背景</button><button id="settings-test"><i class="fas fa-code"></i>测试</button><button id="settings-about"><i class="far fa-star"></i>关于</button><button id="settings-info"><i class="fas fa-circle-info"></i>系统</button></div><div class="hide fade fade-out" id="settingItems"><div id="settings-general-Content"><h3>主题</h3><div class="settingSwitchCheckBox"><div class="settingSwitchCheckBoxMain"><div class="content-text">Aplayer开关</div><input id="aplayerOnOff" onclick="aplayerState()" type="checkbox"/></div><div class="settingSwitchCheckBoxMain"><div class="content-text">帧率检测</div><input id="fpsDisplay" onclick="fpsState()" type="checkbox"/></div><div class="settingSwitchCheckBoxMain"><div class="content-text">背景流星（夜间模式）</div><input id="universeEffect" onclick="universeState()" type="checkbox"/></div><!--<div class="settingSwitchCheckBoxMain">
 <div class="content-text">背景透明</div>
 <input type="checkbox" id="contentInnerTransOnOff" onclick="contentInnerTransState()">
 </div>--><div class="settingSwitchCheckBoxMain"><div class="content-text">顶部显隐（首页）</div><input id="indexImgDisplay" onclick="indexImgState()" type="checkbox"/></div><div class="settingSwitchCheckBoxMain"><div class="content-text">测试按钮【供调试使用】</div><input id="variable1" onclick="switchState1()" type="checkbox"/></div></div><hr/><!--<div class="slider-container">
 <div class="value-display" id="valueDisplay"></div>
 <input type="range" id="opacityRange" min="0" max="100" value="95">
 </div>
 <div class="slider-container">
 <div class="value-display" id="valueDisplayStButtons"></div>
 <input type="range" id="opacityRangeStButtons" min="0" max="100" value="30">
 </div>--><div class="slider-container"><div class="value-display">控制台透明度：<span id="settingBgOp"></span></div><input id="settingBgOpRange" value="95" max="100" min="0" type="range"/></div><!--<div class="slider-container">
 <div class="value-display">控制台按钮透明度：<span id="settingBgOp"></span></div>
 <input type="range" id="settingBgOpRange" min="0" max="100" value="30">
 </div>--><div class="slider-container"><div class="value-display">控制台遮罩透明度：<span id="settingBgMaskOp"></span></div><input id="settingBgMaskOpRange" value="30" max="100" min="0" type="range"/></div><!--<div class="slider-container">
 <div class="value-display">背景遮罩透明度：<span id="settingBgOp"></span></div>
 <input type="range" id="settingBgOpRange" min="0" max="100" value="80">
 </div>--><hr/><div class="settingRadioGroup"><div class="settingRadioGroupMain"><div class="content-text">春节灯笼（PC）</div><div class="settingRadioGroupOption"><input id="lanternState1" onclick="removeLantern()" value="close" name="lanternDisplay" type="radio"/><label for="lanternState1">关</label><input id="lanternState2" onclick="lanternLeft()" value="left" name="lanternDisplay" type="radio"/><label for="lanternState2">左</label><input id="lanternState3" onclick="lanternRight()" value="right" name="lanternDisplay" type="radio"/><label for="lanternState3">右</label></div></div><div class="settingRadioGroupMain"><div class="content-text">内容区域背景</div><div class="settingRadioGroupOption"><input id="contentInnerBgOpState1" onclick="contentInnerBgOp0()" value="op0" name="contentInnerBgOpDisplay" type="radio"/><label for="contentInnerBgOpState1">透明</label><input id="contentInnerBgOpState2" onclick="contentInnerBgOp85()" value="op85" name="contentInnerBgOpDisplay" type="radio"/><label for="contentInnerBgOpState2">85%</label><input id="contentInnerBgOpState3" onclick="contentInnerBgOp100()" value="op100" name="contentInnerBgOpDisplay" type="radio"/><label for="contentInnerBgOpState3">不透明</label></div></div><div class="settingRadioGroupMain"><div class="content-text">aplayer 外观</div><div class="settingRadioGroupOption"><input id="aplayerSkinStyle1" onclick="aplayerSkinStyle1()" value="skin1" name="aplayerSkinStyleDisplay" type="radio"/><label for="aplayerSkinStyle1">样式1</label><input id="aplayerSkinStyle2" onclick="aplayerSkinStyle2()" value="skin2" name="aplayerSkinStyleDisplay" type="radio"/><label for="aplayerSkinStyle2">样式2</label></div></div><div class="settingRadioGroupMain"><div class="content-text">测试 Radio【供调试使用】</div><div class="settingRadioGroupOption"><input id="radio2-name1" onclick="radio2Func1()" value="11111" name="drone2" type="radio"/><label for="radio2-name1">Huey-2</label><input id="radio2-name2" onclick="radio2Func2()" value="22222" name="drone2" type="radio"/><label for="radio2-name2">Dewey-2</label><input id="radio2-name3" onclick="radio2Func3()" value="33333" name="drone2" type="radio"/><label for="radio2-name3">Louie-2</label></div></div></div><hr/><h3>清理</h3><div><button id="resetSwitches">还原所有设置开关</button><br/><button id="resetRangeBar">还原所有范围控件</button><button id="resetRangeBar-settingBgOpRange">还原Bg范围控件</button><button id="resetRangeBar-settingBgMaskOpRange">还原控制台遮罩范围控件</button><br/><button id="resetRadio">还原 Radio</button><button id="resetRadio-aplayerSkinStyleDisplay">还原 aplayer 外观</button><button id="resetRadio-drone2">还原 Radio 测2</button></div><hr/><h3>控制</h3><div><button id="clearSessionStorage" style="display: none">清除 SessionStorage</button><button id="clearLocalStorage" style="display: none">清除 LocalStorage（重置设置）</button><button id="clearCookies">清除 Cookies</button><button id="clearServiceWorkers" style="display: none">清除 Service Workers 缓存</button><button id="clearCaches">清除缓存</button><br/><button onclick="javascript:location.reload()">刷新页面</button><button onclick="javascript:location.replace(location.href);">强制刷新</button><br/><button style="display: none" onclick="closePanel()">关闭控制台</button></div></div><div id="settings-fonts-Content"><p><button id="resetFont" style="display:flex;width:100%;align-items:center;justify-content:center;"><i class="fa-solid fa-arrows-rotate"></i>恢复默认字体</button></p><h3>字体</h3><div class="settingFontSwitchStyle"><button onclick="setFont('LXGW Wenkai Screen')" style="font-family:'LXGW Wenkai Screen'!important">霞鹜文楷</button><button onclick="setFont('Source Han Serif SC Medium')" style="font-family:'Source Han Serif SC Medium'!important">思源宋体</button><button onclick="setFont('Source Han Sans CN Medium')" style="font-family:'Source Han Sans CN Medium'!important">思源黑体500</button><button onclick="setFont('Source Han Sans CN Normal')" style="font-family:'Source Han Sans CN Normal'!important">思源黑体400</button><button onclick="setFont('JiangChengYuanTi')" style="font-family:'JiangChengYuanTi'!important">江城圆体400</button><button onclick="setFont('main')" style="font-family:-apple-system, IBM Plex Mono, monospace, '微软雅黑', sans-serif;!important">系统默认</button></div></div><div id="settings-background-Content"><div id="article-container"><p><button id="resetBg" style="display:flex;width:100%;align-items:center;justify-content:center;"><i class="fa-solid fa-arrows-rotate"></i>恢复默认背景</button></p><h3 id="图片（宽屏）"><a class="headerlink" title="图片（宽屏）" href="#图片（宽屏）"></a>图片（宽屏）</h3><div class="bgbox"><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-1.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-1.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-2.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-2.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-3.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-3.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-4.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-pc-4.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202307/8fcf913bba1a703714e2dc7cd1bdba3e--2133436291.jpg)')" style="background-image: url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202307/8fcf913bba1a703714e2dc7cd1bdba3e--2133436291.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202407/18eb61a58120b76130803b26246d83f7--208058497.jpg)')" style="background-image: url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202407/18eb61a58120b76130803b26246d83f7--208058497.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202408/4d78b8c4a3a3547c0e3b21b85401b687--1602406427.jpg)')" style="background-image: url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202408/4d78b8c4a3a3547c0e3b21b85401b687--1602406427.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202405/4a913a3a8d36b0fd2dd28de7cb9f7c08--2822596592.jpg)')" style="background-image: url(https://cdn-hw-static2.shanhutech.cn/bizhi/staticwp/202405/4a913a3a8d36b0fd2dd28de7cb9f7c08--2822596592.jpg)" rel="noopener external nofollow" href="javascript:;"></a></div><h3 id="图片（移动端）"><a class="headerlink" title="图片（移动端）" href="#图片（移动端）"></a>图片（移动端）</h3><div class="bgbox"><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-1.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-1.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-2.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-2.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-3.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-3.jpg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-4.jpg)')" style="background-image: url(https://cdncf-assets.sakurink.eu.org/blogassets/img/bg/bg-m-4.jpg)" rel="noopener external nofollow" href="javascript:;"></a></div><h3 id="图片（随机-宽屏）"><a class="headerlink" title="图片（随机-宽屏）" href="#图片（随机-宽屏）"></a>图片（随机-宽屏）</h3><div class="bgbox"><a class="imgbox" onclick="changeBg('url(https://bing.img.run/1920x1080.php)')" style="background-image: url(https://bing.img.run/1920x1080.php)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://wp.upx8.com/api.php)')" style="background-image: url(https://wp.upx8.com/api.php)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://unsplash.it/1280/720?random)')" style="background-image: url(https://unsplash.it/1280/720?random)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://www.loliapi.com/acg/)')" style="background-image: url(https://www.loliapi.com/acg/)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://api.vvhan.com/api/wallpaper/acg)')" style="background-image: url(https://api.vvhan.com/api/wallpaper/acg)" rel="noopener external nofollow" href="javascript:;"></a><a class="imgbox" onclick="changeBg('url(https://www.dmoe.cc/random.php)')" style="background-image: url(https://www.dmoe.cc/random.php)" rel="noopener external nofollow" href="javascript:;"></a></div><h3 id="渐变色"><a class="headerlink" title="渐变色" href="#渐变色"></a>渐变色</h3><div class="bgbox"><a class="colorbox" onclick="changeBg('linear-gradient(to right, #eecda3, #ef629f)')" style="background: linear-gradient(to right, #eecda3, #ef629f)" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('linear-gradient(to right, #e4afcb 0%, #b8cbb8 0%, #b8cbb8 0%, #e2c58b 30%, #c2ce9c 64%, #7edbdc 100%)')" style="background: linear-gradient(to right, #e4afcb 0%, #b8cbb8 0%, #b8cbb8 0%, #e2c58b 30%, #c2ce9c 64%, #7edbdc 100%)" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('linear-gradient(to top, #30cfd0 0%, #330867 100%)')" style="background: linear-gradient(to top, #30cfd0 0%, #330867 100%)" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%)')" style="background: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%)" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('linear-gradient(to right, #EAECC6, #2BC0E4)')" style="background: linear-gradient(to right, #EAECC6, #2BC0E4)" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('linear-gradient(60deg, #ffd7e4 0%, #c8f1ff 100%)')" style="background: linear-gradient(60deg, #ffd7e4 0%, #c8f1ff 100%)" rel="noopener external nofollow" href="javascript:;"></a></div><h3 id="纯色"><a class="headerlink" title="纯色" href="#纯色"></a>纯色</h3><div class="bgbox"><a class="colorbox" onclick="changeBg('#eef7f2')" style="background: #eef7f2" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('#7D9D9C')" style="background: #7D9D9C" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('#C7EDCC')" style="background: #C7EDCC" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('#E3DCCF')" style="background: #E3DCCF" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('#0F69B8')" style="background: #0F69B8" rel="noopener external nofollow" href="javascript:;"></a><a class="colorbox" onclick="changeBg('#F0AABE')" style="background: #F0AABE" rel="noopener external nofollow" href="javascript:;"></a></div></div></div><div id="settings-test-Content"><h2>什么是Lorem Ipsum?</h2><p>Lorem Ipsum，也称乱数假文或者哑元文本， 是印刷及排版领域所常用的虚拟文字。由于曾经一台匿名的打印机刻意打乱了一盒印刷字体从而造出一本字体样品书，Lorem Ipsum从西元15世纪起就被作为此领域的标准文本使用。它不仅延续了五个世纪，还通过了电子排版的挑战，其雏形却依然保存至今。在1960年代，”Leatraset”公司发布了印刷着Lorem Ipsum段落的纸张，从而广泛普及了它的使用。最近，计算机桌面出版软件”Aldus PageMaker”也通过同样的方式使Lorem Ipsum落入大众的视野。</p><h2>字母测试</h2><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas justo elit, posuere ac vestibulum at, hendrerit sed lectus. Aliquam hendrerit faucibus odio sed dignissim. Morbi nec nisl non mi tincidunt faucibus id vitae lectus. Etiam scelerisque nisl velit, sed euismod risus congue nec. Quisque hendrerit tortor eu arcu posuere, eu mattis purus egestas. Nulla tincidunt aliquet magna ac scelerisque. Suspendisse sed orci iaculis, elementum elit in, laoreet mi. Praesent mauris lectus, ultricies nec quam sed, pretium tristique diam. Aenean vitae vulputate dui, et elementum erat. Donec eros dui, porta et ipsum id, mattis dapibus turpis. Praesent vel nisi vitae mi faucibus sagittis id eu tortor. Nam dignissim dolor nec odio fringilla vulputate. Morbi vehicula elit at bibendum finibus. Nullam at enim diam. In consectetur urna sit amet ipsum euismod suscipit. Donec nec finibus eros.</p></div><div id="settings-about-Content"><div style="display: flex; justify-content: center; align-items: center; text-align: center;"><div class="highlighter-green" style="display: inline-block;color: white; font-weight: bold; font-style: italic; text-shadow: 1px 1px 5px black;"><b>Sakurink Control Panel</b></div></div><br/><div>Dev version</div></div><div id="settings-info-Content"><h3>部分属性检测</h3><style type="text/css">.hasSupportCheck .hasSupport {
  display: none;
  }
  .hasSupportCheck .hasNonsupport {
  display:inline;
  }
  .hasSupportCheck:has(.hasSupportCheckFlag) .hasSupport {
  display:inline;
  }
  .hasSupportCheck:has(.hasSupportCheckFlag) .hasNonsupport {
  display: none;
  }</style><div class="hasSupportCheck"><div class="hasSupportCheckFlag"></div><p><b>:has() CSS -></b><span class="hasSupport">支持</span><span class="hasNonsupport">不支持，尝试使用兼容方案（效果可能不佳）</span></p></div><br/><h3>系统信息</h3><p><b>UserAgent-></b><span id="userAgent"></span></p><p><b>Language-></b><span id="language"></span></p><p><b>Platform-></b><span id="platform"></span></p><p><b>MaxTouchPoints-></b><span id="maxTouchPoints"></span></p><!-- <p><b>Referrer-></b><span id="referrer"></span></p>--><p><b>Browser-></b><span id="browserName"></span></p><p><b>OSName-></b><span id="osName"></span></p><br/><h3>Chromium</h3><p><b>UserAgentData.brands-></b><span id="userAgentDataBrands"></span></p><p><b>UserAgentData.mobile-></b><span id="userAgentDataMobile"></span></p><p><b>UserAgentData.Platform-></b><span id="userAgentDataPlatform"></span></p></div></div><hr/><div class="fade fade-in" id="settingWidget"><div class="sp-cal-card"><div class="sp-cal-header"><div><i class="fas fa-calendar-alt"></i><span id="sp-cal-monthYear"></span></div><button class="sp-cal-button" id="sp-cal-prevMonth">上个月</button><button class="sp-cal-button" id="sp-cal-nextMonth">下个月</button><button class="sp-cal-button" id="sp-cal-today">回到今日</button></div><div class="sp-calendar" id="sp-cal-calendar"><div class="sp-cal-days-of-week"><div class="sp-cal-day">一</div><div class="sp-cal-day">二</div><div class="sp-cal-day">三</div><div class="sp-cal-day">四</div><div class="sp-cal-day">五</div><div class="sp-cal-day">六</div><div class="sp-cal-day">日</div></div></div></div></div></div><div id="settingBottomBar"><button id="settingScrollToTop"><i class="fas fa-arrow-up"></i>返回顶部</button><button onclick="clearLocalStorage()"><i class="fas fa-arrows-rotate"></i>还原设置</button><button id="settingFullScreen"><i class="fas fa-expand"></i>全屏</button><button id="menu-darkmode"><i class="fas fa-moon"></i>昼夜切换</button></div></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://npm.elemecdn.com/@fancyapps/ui@latest/dist/fancybox/fancybox.umd.js"></script><script src="https://npm.elemecdn.com/instant.page@latest/instantpage.js" type="module"></script><script src="https://npm.elemecdn.com/node-snackbar@latest/dist/snackbar.min.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://npm.elemecdn.com/katex@latest/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://npm.elemecdn.com/katex@latest/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"reaction":false,"search":false}

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://apivc-waline.sakurink.eu.org',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://fastly.jsdelivr.net/npm/@waline/client@latest/dist/waline.min.css')
        .then(() => import('https://fastly.jsdelivr.net/npm/@waline/client@latest/dist/waline.umd.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script defer src="/js/reurl.js"></script><script defer data-pjax src="/js/sakurink.js"></script><canvas id="universe"></canvas><script defer data-pjax src="/js/universe.js"></script><div th:fragment="lantern" id="lantern" style="display: none;"><div class="lantern-box-1"><div class="lantern-main"><div class="lantern-lift"></div><div class="lantern-a"><div class="lantern-b"><div class="lantern-t">节</div></div></div><div class="lantern-spike lantern-spike-a"><div class="lantern-spike-c"></div><div class="lantern-spike-b"></div></div></div></div><div class="lantern-box-2"><div class="lantern-main"><div class="lantern-lift"></div><div class="lantern-a"><div class="lantern-b"><div class="lantern-t">春</div></div></div><div class="lantern-spike lantern-spike-a"><div class="lantern-spike-c"></div><div class="lantern-spike-b"></div></div></div></div></div><script defer src="/js/consolex.js"></script><meting-js class="aplayerBgMusic" server="netease" type="playlist" id="8735348027" fixed="true" mini="true" volume="0.2" listFolded="true" preload="none" autoplay="false" muted></meting-js><link rel="stylesheet" href="https://npm.elemecdn.com/aplayer@1.10.1/dist/APlayer.min.css" /><script defer src="https://npm.elemecdn.com/aplayer@1.10.1/dist/APlayer.min.js"></script><script defer src="/js/Meting-sr.min.js"></script><script async src="/js/runtime.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://npm.elemecdn.com/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://npm.elemecdn.com/pjax@latest/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>